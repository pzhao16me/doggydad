---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const categories = ['reading-notes', 'turing-award', 'tech-learning', 'general'];
  return categories.map(category => ({
    params: { category },
    props: { category }
  }));
}

const { category } = Astro.props;

const allPosts = await getCollection('posts');
const posts = allPosts
  .filter(post => post.slug.startsWith(category + '/'))
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime());

const categories = {
  'reading-notes': { name: 'ğŸ“š è¯»ä¹¦ç¬”è®°', icon: 'ğŸ“šğŸ“–', color: '#e74c3c' },
  'turing-award': { name: 'ğŸ† å›¾çµå¥–ç³»åˆ—', icon: 'ğŸ†ğŸ–ï¸', color: '#f39c12' },
  'tech-learning': { name: 'ğŸ’» æŠ€æœ¯å­¦ä¹ ', icon: 'ğŸ’»ğŸ–¥ï¸', color: '#3498db' },
  'general': { name: 'ğŸ“ é€šç”¨', icon: 'ğŸ“ğŸ“„', color: '#9b59b6' }
};

const catInfo = categories[category] || { name: category, icon: 'ğŸ“„', color: '#666' };

function getCategoryInfo(cat: string) {
  return categories[cat] || { name: cat, icon: 'ğŸ“„', color: '#666' };
}
---

<BaseLayout title={`${catInfo.name} - DoggyDad Blog`} description={`${catInfo.name}åˆ†ç±»ä¸‹çš„æ‰€æœ‰æ–‡ç« `}>
  <div class="hero">
    <h1>{catInfo.name}</h1>
    <p>å…± {posts.length} ç¯‡æ–‡ç« </p>
  </div>
  
  <div class="category-filter">
    <a href="/doggydad/" class="category-btn">å…¨éƒ¨</a>
    {Object.entries(categories).map(([key, cat]) => (
      <a href={`/doggydad/category/${key}/`} class={`category-btn ${key === category ? 'active' : ''}`}>
        {cat.icon.split('')[0]} {cat.name.replace(/^[^\s]+ /, '')}
      </a>
    ))}
  </div>
  
  <div class="posts-grid">
    {posts.map(post => {
      const postCatInfo = getCategoryInfo(post.slug.split('/')[0]);
      return (
        <a href={`/doggydad/posts/${post.slug}/`} class="post-card">
          <div class="post-category" style={`color: ${postCatInfo.color}`}>
            {postCatInfo.icon} {postCatInfo.name}
          </div>
          <div class="post-meta">
            <span>ğŸ“… {new Date(post.data.date).toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
            {post.data.tags && post.data.tags.length > 0 && (
              <span>ğŸ·ï¸ {post.data.tags.slice(0, 3).join(', ')}</span>
            )}
          </div>
          <h2>{post.data.title}</h2>
          <p>{post.data.description}</p>
        </a>
      );
    })}
  </div>
</BaseLayout>

<style>
  .hero {
    text-align: center;
    padding: 4rem 0;
    background: linear-gradient(135deg, hsl(210, 100%, 98%), hsl(280, 100%, 98%));
    border-radius: var(--radius-xl);
    margin-bottom: 4rem;
  }
  
  [data-theme="dark"] .hero {
    background: linear-gradient(135deg, hsl(210, 30%, 15%), hsl(280, 30%, 15%));
  }
  
  .hero h1 {
    font-size: 2.5rem;
    background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  .hero p { color: var(--color-text-muted); font-size: 1.125rem; }
  
  .category-filter {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    justify-content: center;
    margin-bottom: 3rem;
  }
  
  .category-btn {
    background: var(--color-surface);
    border: 2px solid var(--color-border);
    border-radius: var(--radius-lg);
    padding: 0.5rem 1.5rem;
    font-weight: 500;
    color: var(--color-text);
    text-decoration: none;
    transition: all 0.15s;
  }
  
  .category-btn:hover {
    border-color: var(--color-primary);
    transform: translateY(-2px);
  }
  
  .category-btn.active {
    background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
    border-color: transparent;
    color: white;
  }
  
  .posts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 2rem;
  }
  
  .post-card {
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    padding: 2rem;
    border: 1px solid var(--color-border);
    text-decoration: none;
    color: inherit;
    transition: all 0.25s;
    position: relative;
    overflow: hidden;
  }
  
  .post-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, var(--color-primary), var(--color-accent));
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.25s;
  }
  
  .post-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    border-color: var(--color-primary);
  }
  
  .post-card:hover::before { transform: scaleX(1); }
  
  .post-category { font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem; }
  
  .post-meta {
    display: flex;
    gap: 1rem;
    font-size: 0.875rem;
    color: var(--color-text-muted);
    margin-bottom: 1rem;
  }
  
  .post-card h2 { font-size: 1.25rem; margin-bottom: 0.5rem; }
  .post-card p { color: var(--color-text-muted); margin: 0; }
</style>
